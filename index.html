<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>MS EDUCATION Pro Online Exam App</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+Da+2:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<style>
/* -------------------- ‡¶•‡¶ø‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° -------------------- */
:root {
    --primary-color: #0d47a1; /* ‡¶ó‡¶æ‡ßù ‡¶®‡ßÄ‡¶≤ */
    --secondary-color: #ffb300; /* ‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶π‡¶≤‡ßÅ‡¶¶ */
    --success-color: #00c853; /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
    --danger-color: #d32f2f; /* ‡¶≤‡¶æ‡¶≤ */
    --info-color: #00bcd4; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶®‡ßÄ‡¶≤ */
    --bg-gradient: linear-gradient(145deg, #1e3c72, #2a5298); /* ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶ó‡¶æ‡ßù ‡¶ó‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü */
    --card-bg: #ffffff;
    --text-color: #212121;
}
body { 
    font-family: 'Baloo Da 2', sans-serif; 
    background: var(--bg-gradient); 
    margin:0; 
    padding:0; 
    display:flex; 
    justify-content:center; 
    min-height:100vh; 
    align-items:flex-start; 
    color: var(--text-color);
}
#app { 
    background: var(--card-bg); 
    padding:30px; 
    border-radius:20px; 
    box-shadow:0 15px 40px rgba(0,0,0,0.6); /* ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã */
    width:100%; 
    max-width:750px; 
    margin-top:40px; 
    margin-bottom: 40px;
    border: 5px solid var(--secondary-color); 
    display: none; 
    transition: all 0.5s ease;
}
h2 { 
    text-align:center; 
    color: var(--primary-color); 
    margin-bottom:25px; 
    border-bottom: 3px solid var(--secondary-color); 
    padding-bottom: 15px;
    font-size: 30px;
    font-weight: 800;
}
/* -------------------- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü -------------------- */
.input-group{margin:15px 0;}
input, select, textarea{
    width:100%; 
    padding:16px; 
    border-radius:8px; 
    border:1px solid #ccc; 
    font-size:17px; 
    box-sizing: border-box;
    transition: all 0.3s;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}
input:focus, select:focus, textarea:focus { 
    border-color: var(--primary-color); 
    box-shadow: 0 0 10px rgba(13, 71, 161, 0.5); 
}
/* -------------------- ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ -------------------- */
button{
    width:100%; 
    padding:16px; 
    border:none; 
    font-size:18px; 
    border-radius:8px; 
    cursor:pointer; 
    margin-top:15px; 
    transition: all 0.3s ease; 
    box-shadow:0 4px 15px rgba(0,0,0,0.2); 
    font-weight:bold;
    display: flex;
    align-items: center;
    justify-content: center;
}
button:hover{transform: translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.3);}
button i { margin-right: 10px; font-size: 20px; }

#teacher button:not(.share-btn):not(.utility-btn){background:var(--success-color); color:white;}
#quiz .options button{background:var(--primary-color); color:white; margin-bottom: 12px;}
#quiz .options button:hover{background:#0d3d8f;}

/* Share Buttons */
#shareWhatsapp{background:#25D366;}
#shareMessenger{background:#0084FF;}
#shareTelegram{background:#0088cc;}

/* Utility Buttons (‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤) */
.utility-btn {
    background: var(--info-color) !important;
    color: white !important;
    margin-bottom: 10px;
}
/* -------------------- ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü -------------------- */
table{width:100%; border-collapse:collapse; margin-top:20px;}
table, th, td{border:1px solid #ddd;}
th, td{padding:12px; text-align:center; font-size: 15px;}
th{background:var(--primary-color); color:white; font-size: 16px;}
.result{text-align:center; font-size:26px; margin-top:30px; font-weight: 800; color: var(--danger-color);}
.detail-btn { 
    background: var(--secondary-color); 
    color: var(--text-color); 
    width: auto !important; 
    padding: 8px 15px !important; 
    margin: 0; 
    font-size: 15px !important;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.detail-btn i { color: var(--text-color); margin-right: 5px; }

/* -------------------- SPLASH/INTRO ANIMATION -------------------- */
#splashScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--bg-gradient); display: flex;
    justify-content: center; align-items: center; flex-direction: column;
    z-index: 9999; color: white; font-family: 'Baloo Da 2', sans-serif;
}
.splash-title {
    font-size: 60px;
    font-weight: 800;
    margin-bottom: 20px;
    opacity: 0;
    animation: fadeInScale 2s forwards;
    letter-spacing: 3px;
    border: 5px solid var(--secondary-color);
    padding: 20px 40px;
    border-radius: 20px;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.7);
}
.splash-subtitle {
    font-size: 28px;
    opacity: 0;
    animation: fadeIn 2s 1s forwards;
}
@keyframes fadeInScale {
    0% { transform: scale(0.5); opacity: 0; }
    80% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); }
}
@keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

/* -------------------- ‡¶ú‡ßç‡¶¨‡¶≤‡¶®‡ßç‡¶§ ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ (RGB Glow & Move Effect) -------------------- */
.glow-title {
    text-align: center;
    font-size: 35px; 
    font-weight: 800;
    margin-bottom: 5px; /* ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
    
    /* RGB Glow Set Up */
    color: #fff;
    background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    /* Animation: Glow + Horizontal Move */
    animation: rgbGlowAndMove 4s infinite linear alternate, 
               horizontalMove 1.5s infinite alternate ease-in-out;
    
    display: block; 
    padding: 5px 0;
    width: fit-content; 
    margin-left: auto; 
    margin-right: auto; 
}

/* RGB ‡¶ï‡¶æ‡¶≤‡¶æ‡¶∞ ‡¶ó‡ßç‡¶≤‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
@keyframes rgbGlowAndMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* ‡¶°‡¶æ‡¶®‡ßá-‡¶¨‡¶æ‡¶Æ‡ßá ‡¶∏‡¶∞‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
@keyframes horizontalMove {
    from { transform: translateX(-15px); } 
    to { transform: translateX(15px); }
}

/* ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.teacher-info {
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
    color: #424242; /* ‡¶ó‡¶æ‡ßù ‡¶ß‡ßÇ‡¶∏‡¶∞ */
    font-weight: 700;
    line-height: 1.5;
}
.teacher-info span {
    color: var(--primary-color);
    font-weight: 800;
}

/* -------------------- Modal ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ü ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ -------------------- */
.modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
.modal-content { 
    background-color: var(--card-bg); margin: 5% auto; padding: 25px; border-radius: 15px; 
    width: 90%; max-width: 700px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.close { color: #aaa; float: right; font-size: 32px; font-weight: bold; }
.close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }
#resultSheet {
    border: 2px solid var(--primary-color); 
    padding: 20px; 
    border-radius: 10px; 
    margin-top: 15px;
}
.sheet-header h3 {
    color: var(--primary-color);
    border-bottom: 2px dashed var(--secondary-color);
    padding-bottom: 10px;
    margin-bottom: 5px;
}
.sheet-info p { margin: 5px 0; font-size: 16px; }
.ans-correct { color: var(--success-color); font-weight: bold; }
.ans-incorrect { color: var(--danger-color); font-weight: bold; }

/* Print ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
@media print {
    body * { visibility: hidden; }
    #detailModal, #detailModal * { visibility: visible; }
    #detailModal { position: absolute; left: 0; top: 0; }
    .close, #printBtn { display: none !important; }
    .modal-content { margin: 0; width: 100%; box-shadow: none; border: none; }
    #resultSheet { border: none; }
}
</style>
</head>
<body>

<div id="splashScreen">
    <div class="splash-title">MS EDUCATION</div>
    <div class="splash-subtitle">‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ</div>
</div>

<div id="app">
<div id="teacher">
<div class="glow-title">MS EDUCATION</div>

<div class="teacher-info">
    ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï: **‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®**<br>
    <i class="fas fa-mosque" style="color: var(--primary-color);"></i> ‡¶Ü‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶∞‡¶æ ‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶Æ‡¶æ‡¶¶‡¶∞‡¶æ‡¶∏‡¶æ
</div>

<h2><i class="fas fa-chalkboard-teacher"></i> ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
<div class="input-group">
<input type="text" id="examTitle" placeholder="‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
</div>
<div class="input-group">
<input type="number" id="examDuration" placeholder="‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá)">
</div>
<p class="warning"><i class="fas fa-exclamation-triangle"></i> ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶è‡ßú‡¶æ‡¶§‡ßá ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

<div id="questionForms">
<div class="question-container">
<div class="input-group"><input type="text" class="qText" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div>
<div class="input-group">
<input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß">
<input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®">
<input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©">
<input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™">
</div>
<div class="input-group">
<label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
<select class="correctAnswer">
<option value="0">‡¶Ö‡¶™‡¶∂‡¶® ‡ßß</option>
<option value="1">‡¶Ö‡¶™‡¶∂‡¶® ‡ß®</option>
<option value="2">‡¶Ö‡¶™‡¶∂‡¶® ‡ß©</option>
<option value="3">‡¶Ö‡¶™‡¶∂‡¶® ‡ß™</option>
</select>
</div>
</div>
</div>
<button id="addQuestionBtn" onclick="addQuestion()"><i class="fas fa-plus-circle"></i> ‡¶Ü‡¶∞‡¶ì ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button onclick="generateExamLink()"><i class="fas fa-link"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>

<div id="examLinkContainer" style="display:none;">
<div class="glow-title" style="font-size: 30px;">MS EDUCATION - ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</div>
<div id="examLink" class="link-box"></div>

<button id="shareWhatsapp" class="share-btn" onclick="shareLink('whatsapp')"><i class="fab fa-whatsapp"></i> WhatsApp ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button id="shareMessenger" class="share-btn" onclick="shareLink('messenger')"><i class="fab fa-facebook-messenger"></i> Messenger ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<button id="shareTelegram" class="share-btn" onclick="shareLink('telegram')"><i class="fab fa-telegram-plane"></i> Telegram ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<h3><i class="fas fa-clipboard-list"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
<button class="utility-btn" onclick="updateResultTable()"><i class="fas fa-sync-alt"></i> ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>

<table id="resultTable">
<tr>
<th>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç</th><th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th><th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</th>
</tr>
</table>
</div>

<div id="student" style="display:none;">
<div class="glow-title">MS EDUCATION</div>
<div class="teacher-info">
    ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ‡ßü: **‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®**<br>
    <i class="fas fa-mosque" style="color: var(--primary-color);"></i> ‡¶Ü‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶∞‡¶æ ‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶Æ‡¶æ‡¶¶‡¶∞‡¶æ‡¶∏‡¶æ
</div>
<h2><i class="fas fa-edit"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
<div class="input-group">
<label class="mandatory-label">‡¶õ‡¶æ‡¶§‡ßç‡¶∞/‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
<input type="text" id="studentName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
</div>
<div class="input-group">
<label class="mandatory-label">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ (Class):</label>
<select id="studentClass">
<option value="">-- ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
<script>
    for (let i = 1; i <= 12; i++) {
        document.write(`<option value="Class ${i}">Class ${i}</option>`);
    }
</script>
</select>
</div>
<div class="input-group">
<label class="mandatory-label">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
<input type="tel" id="studentMobile" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï)">
</div>
<p style="text-align: center; color: var(--danger-color); font-weight: bold;">‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ó‡¶£‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá‡•§</p>
<button onclick="startExam()"><i class="fas fa-play"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div id="quiz" style="display:none;">
<div class="glow-title">MS EDUCATION</div>
<h2 id="examTitleDisplay"></h2>
<div class="timer" id="timerDisplay">‡¶∏‡¶Æ‡¶Ø‡¶º: 00:00</div>
<div class="question" id="questionText"></div>
<div class="options">
<button onclick="selectAnswer(0)" id="opt0"></button>
<button onclick="selectAnswer(1)" id="opt1"></button>
<button onclick="selectAnswer(2)" id="opt2"></button>
<button onclick="selectAnswer(3)" id="opt3"></button>
</div>
</div>

<div id="result" style="display:none;">
<h2><i class="fas fa-check-circle"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</h2>
<div class="result" id="scoreText"></div>
<p style="text-align: center; color: var(--primary-color); margin-top: 20px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§</p>
</div>
</div>

<div id="error-message">
    ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶≠‡ßÅ‡¶≤‡•§ üòî
    <p style="font-size: 18px; margin-top: 20px;"><a href="${location.href.split("?")[0]}" style="color: var(--primary-color);">‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶® (‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤)</a></p>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalContent">
            </div>
        <button id="printBtn" onclick="window.print()" style="background: var(--info-color); color: white;"><i class="fas fa-print"></i> ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü/PDF ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<script>
// ====================================================================
// !!! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã !!!
// ====================================================================
const firebaseConfig = {
  apiKey: "AIzaSyDmReTiRc0voblz_lUX_UpjL38a6YwC23A",
  authDomain: "project1-64a93.firebaseapp.com",
  projectId: "project1-64a93",
  storageBucket: "project1-64a93.firebasestorage.app",
  messagingSenderId: "198510257374",
  appId: "1:198510257374:web:e6a1b9e74c539f5e120e4f",
};

// Firebase Initialize
let db;
try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
} catch (e) {
    console.error("Firebase Initialization Failed:", e);
}
// ====================================================================


let questions=[], currentQ=0, score=0, studentName="", studentClass="", studentMobile="", examTitle="", examID="", durationMinutes=0;
let studentAnswers = []; 
let timerInterval;

function addQuestion(){
    const formsDiv=document.getElementById('questionForms');
    const newQContainer=document.createElement('div');
    newQContainer.classList.add('question-container');
    newQContainer.innerHTML=`
    <hr>
    <div class="input-group"><input type="text" class="qText" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"></div>
    <div class="input-group">
    <input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß">
    <input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®">
    <input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©">
    <input type="text" class="opt" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™">
    </div>
    <div class="input-group">
    <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
    <select class="correctAnswer">
    <option value="0">‡¶Ö‡¶™‡¶∂‡¶® ‡ßß</option>
    <option value="1">‡¶Ö‡¶™‡¶∂‡¶® ‡ß®</option>
    <option value="2">‡¶Ö‡¶™‡¶∂‡¶® ‡ß©</option>
    <option value="3">‡¶Ö‡¶™‡¶∂‡¶® ‡ß™</option>
    </select>
    </div>
    `;
    formsDiv.appendChild(newQContainer);
}

// ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø
async function generateExamLink(){
    examTitle=document.getElementById('examTitle').value.trim();
    durationMinutes=parseInt(document.getElementById('examDuration').value.trim());

    if(!examTitle){alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!"); return;}
    if(isNaN(durationMinutes) || durationMinutes <= 0){alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá)!"); return;}

    questions=[];
    const qTexts=document.getElementsByClassName('qText');
    const optsAll=document.getElementsByClassName('opt');
    const correctAll=document.getElementsByClassName('correctAnswer');
    let optIndex=0;

    for(let i=0;i<qTexts.length;i++){
        const q=qTexts[i].value.trim();
        if(!q){alert(`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i+1} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!`); return;}
        const options=[];
        let allOptionsFilled = true;
        for(let j=0;j<4;j++){
            const val=optsAll[optIndex].value.trim(); 
            if(!val){
                alert(`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i+1}-‡¶è‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ${j+1} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!`); 
                allOptionsFilled = false;
                break;
            }
            options.push(val);
            optIndex++; 
        }
        if (!allOptionsFilled) return; 
        questions.push({
            question: q, 
            options: options, 
            answer: parseInt(correctAll[i].value)
        });
    }
    if (questions.length === 0) {
        alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®!");
        return;
    }

    examID="PRO"+Math.random().toString(36).substr(2, 9).toUpperCase(); 

    const examData = {
        title: examTitle,
        duration: durationMinutes,
        questions: questions,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        if (!db) { throw new Error("Firebase DB not initialized."); }
        await db.collection("exams").doc(examID).set(examData);
        
        const link=`${location.href.split("?")[0]}?id=${examID}`;
        
        document.getElementById('examLinkContainer').style.display="block";
        document.getElementById('examLink').innerHTML=`<strong>üîó ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</strong><br><a href="${link}" target="_blank">${link}</a>`;
        
        document.getElementById('shareWhatsapp').style.display="block";
        document.getElementById('shareMessenger').style.display="block";
        document.getElementById('shareTelegram').style.display="block";
        
        if (location.protocol === 'file:') {
             alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø! ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶õ‡ßá‡¶®‡•§ ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ‡¶§‡ßá, ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® GitHub Pages)‡•§");
        } else {
             alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!"); 
        }
       
    } catch (e) {
        console.error("‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
        alert(`‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}.`);
    }
}

// ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function shareLink(platform){
    const link=`${location.href.split("?")[0]}?id=${examID}`;
    const message=`üö® ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ: ${examTitle}\n\n‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶ø‡¶§‡ßá, ‡¶è‡¶á ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ: ${durationMinutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡•§\n\n${link}`;
    let url="";

    if (location.protocol === 'file:') {
        alert("‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá‡¶®‡•§ ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡ßá‡¶§‡ßá, ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶á HTML ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® (GitHub Pages)‡•§");
        navigator.clipboard.writeText(message).then(() => {
            alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        });
        return;
    }
    
    switch(platform){
    case 'whatsapp': 
        url=`https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`; 
        break;
    case 'telegram': 
        url=`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(message)}`; 
        break;
    case 'messenger': 
        navigator.clipboard.writeText(message).then(() => {
            alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶Æ‡ßá‡¶∏‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }).catch(err => {
            alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶ú‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®:\n" + link);
        });
        return; 
    }
    
    if (url) {
        window.open(url,'_blank');
    }
}

// ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ
function startExam(){
    studentName=document.getElementById('studentName').value.trim();
    studentClass=document.getElementById('studentClass').value;
    studentMobile=document.getElementById('studentMobile').value.trim(); 

    if(!studentName){alert("‡¶õ‡¶æ‡¶§‡ßç‡¶∞/‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!"); return;}
    if(!studentClass || studentClass === ""){alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!"); return;}
    if(!studentMobile){alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®!"); return;}

    studentAnswers = questions.map(q => ({
        qText: q.question, 
        qOptions: q.options,
        correctAnswerIndex: q.answer,
        studentAnswerIndex: -1 
    }));
    
    document.getElementById('student').style.display="none";
    document.getElementById('quiz').style.display="block";
    startTimer(durationMinutes);
    showQuestion();
}

function startTimer(minutes){
    let time=minutes*60;
    const timerDisplay=document.getElementById('timerDisplay');
    clearInterval(timerInterval);

    timerInterval=setInterval(()=>{
    const min=String(Math.floor(time/60)).padStart(2,'0');
    const sec=String(time%60).padStart(2,'0');
    timerDisplay.innerText=`‡¶∏‡¶Æ‡¶Ø‡¶º: ${min}:${sec}`;

    if(time<=60){timerDisplay.style.color='var(--danger-color)';} 
    if(time<=0){
    clearInterval(timerInterval);
    selectAnswer(-1); 
    }
    time--;
    }, 1000);
}

function showQuestion(){
    document.getElementById('examTitleDisplay').innerText=examTitle;
    const qDiv=document.getElementById('questionText');
    qDiv.innerText=`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${currentQ+1}/${questions.length}: ${questions[currentQ].question}`;

    for(let i=0;i<4;i++){
    document.getElementById('opt'+i).innerText=`${i+1}. ${questions[currentQ].options[i]}`;
    }
}

function selectAnswer(optIndex){
    if(currentQ < questions.length) {
        studentAnswers[currentQ].studentAnswerIndex = optIndex;

        if(optIndex !== -1 && optIndex === questions[currentQ].answer) { 
            score++;
        }
    }
    
    currentQ++;
    if(currentQ<questions.length) {
        showQuestion();
    } else {
        showResult();
    }
}

// ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£
async function showResult(){
    clearInterval(timerInterval);
    document.getElementById('quiz').style.display="none";
    
    const rDiv=document.getElementById('scoreText');
    rDiv.innerText=`${studentName}, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ì ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`; 

    document.getElementById('result').style.display="block";

    const resultData = {
        examID: examID,
        examTitle: examTitle,
        studentName: studentName,
        studentClass: studentClass,
        studentMobile: studentMobile,
        score: `${score}/${questions.length}`,
        answers: studentAnswers, 
        totalQuestions: questions.length, 
        totalCorrect: score,             
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        if (!db) { throw new Error("Firebase DB not initialized."); }
        await db.collection("results").add(resultData);
        updateResultTable(); 
    } catch (e) {
        console.error("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
        alert(`‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}.`);
    }
}

// ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
async function updateResultTable(){
    const table=document.getElementById('resultTable');
    table.innerHTML=`<tr><th>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</th><th>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç</th><th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th><th>‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</th></tr>`; 
    
    if (!db) return;
    
    try {
        const snapshot = await db.collection("results").orderBy("timestamp", "desc").limit(50).get();
        snapshot.forEach(doc => {
            const res = doc.data();
            const row=table.insertRow();
            row.insertCell(0).innerText=res.examTitle;
            row.insertCell(1).innerText=res.studentName;
            row.insertCell(2).innerText=res.studentClass;
            row.insertCell(3).innerText=res.studentMobile;
            row.insertCell(4).innerText=res.score;
            
            const detailCell = row.insertCell(5);
            const detailBtn = document.createElement('button');
            detailBtn.innerText = '‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
            detailBtn.classList.add('detail-btn');
            detailBtn.innerHTML = '<i class="fas fa-eye"></i> ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
            detailBtn.onclick = () => showDetailedResult(res);
            detailCell.appendChild(detailBtn);
        });
    } catch (e) {
        console.error("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
    }
}

// *** ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ì ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ***
function showDetailedResult(res) {
    const modal = document.getElementById('detailModal');
    const modalContentDiv = document.getElementById('modalContent');
    const totalQuestions = res.totalQuestions || res.answers.length;
    const scoreParts = res.score ? res.score.split('/') : ['0', totalQuestions];
    const totalCorrect = parseInt(scoreParts[0]);
    const totalIncorrect = totalQuestions - totalCorrect;
    const date = res.timestamp ? new Date(res.timestamp.seconds * 1000).toLocaleString('bn-BD') : 'N/A';

    // 1. ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ü ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø
    let html = `
    <div id="resultSheet">
        <div class="sheet-header">
            <h3 style="margin-bottom: 5px; color: var(--primary-color);">MS EDUCATION</h3>
            <h4 style="margin-top: 5px; color: var(--success-color);">${res.examTitle}</h4>
            <p style="font-size: 14px; color: #666;">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${date}</p>
        </div>
        
        <div class="sheet-info" style="background: #f7f9fc; border: 1px solid #e0e0e0; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
            <p><i class="fas fa-user-graduate" style="color: var(--primary-color);"></i> <strong>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${res.studentName}</p>
            <p><i class="fas fa-school" style="color: var(--primary-color);"></i> <strong>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ:</strong> ${res.studentClass}</p>
            <p><i class="fas fa-phone-alt" style="color: var(--primary-color);"></i> <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç:</strong> ${res.studentMobile}</p>
            <hr style="margin: 10px 0; border-top: 1px dashed #ccc;">
            <p><i class="fas fa-star" style="color: var(--secondary-color);"></i> <strong>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞:</strong> <span class="result">${res.score}</span></p>
            <p><i class="fas fa-check" style="color: var(--success-color);"></i> <strong>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</strong> ${totalCorrect}</p>
            <p><i class="fas fa-times" style="color: var(--danger-color);"></i> <strong>‡¶≠‡ßÅ‡¶≤/‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ:</strong> ${totalIncorrect}</p>
        </div>
        
        <h4><i class="fas fa-clipboard-check"></i> ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h4>
        <hr>
    `;

    // 2. ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§
    res.answers.forEach((q, index) => {
        const studentAnsIndex = q.studentAnswerIndex;
        const correctAnsIndex = q.correctAnswerIndex;
        const isCorrect = studentAnsIndex === correctAnsIndex;
        
        let borderStyle = isCorrect ? 'solid var(--success-color)' : 'solid var(--danger-color)';

        html += `<div class="detail-item" style="border-left: 5px ${borderStyle}; background: #fff; padding: 12px; border-radius: 5px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div class="q-text">${index + 1}. ${q.qText}</div>`;
        
        // ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®
        q.qOptions.forEach((opt, optIndex) => {
            let style = 'font-size: 15px; margin: 3px 0 0 10px;';
            let label = '';
            
            if (optIndex === correctAnsIndex) {
                style += ' color: var(--success-color); font-weight: 700;'; 
                label = ' (‡¶∏‡¶†‡¶ø‡¶ï)';
            }
            if (optIndex === studentAnsIndex && !isCorrect) {
                style += ' color: var(--danger-color); font-weight: 700; text-decoration: line-through;';
                label = ' (‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞)';
            } else if (optIndex === studentAnsIndex && isCorrect) {
                style += ' color: var(--success-color); font-weight: 700;';
            }
            
            html += `<p style="${style}">
                ${optIndex + 1}. ${opt}${label}
            </p>`;
        });

        if (studentAnsIndex === -1) {
            html += `<p style="margin-top: 5px;" class="ans-incorrect">‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶ü‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>`;
        }
        
        html += `</div>`;
    });
    
    html += `</div>`;
    
    modalContentDiv.innerHTML = html;
    modal.style.display = "block";
}

function closeModal() {
    document.getElementById('detailModal').style.display = "none";
}

window.onclick = function(event) {
    const modal = document.getElementById('detailModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

// *** ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ***
window.onload=function(){
    document.getElementById('error-message').style.display="none"; 
    document.getElementById('app').style.display="none"; 

    document.getElementById('splashScreen').style.display="flex";

    setTimeout(async () => {
        document.getElementById('splashScreen').style.display="none";
        
        if (!db) {
            document.getElementById('error-message').innerText = "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶è‡¶¨‡¶Ç Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
            document.getElementById('error-message').style.display="block";
            return;
        }
        
        const params=new URLSearchParams(window.location.search);
        
        // ‡¶Ø‡¶¶‡¶ø URL ‡¶è ID ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Æ‡ßã‡¶°
        if(params.has('id')){
            const id=params.get('id');
            try {
                const doc = await db.collection("exams").doc(id).get();
                if(doc.exists){
                    const examData = doc.data();
                    
                    document.getElementById('app').style.display="block";
                    examTitle=examData.title;
                    questions=examData.questions;
                    durationMinutes=examData.duration;
                    document.getElementById('student').style.display="block";
                    
                    // ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
                    document.getElementById('teacher').style.display="none"; 
                } else {
                    // ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶ó‡ßá‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                    document.getElementById('app').style.display="block";
                    document.getElementById('error-message').style.display="block";
                    document.getElementById('teacher').style.display="none"; 
                }
            } catch (e) {
                console.error("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
                // ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá‡¶ì ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                document.getElementById('app').style.display="block";
                document.getElementById('error-message').style.display="block";
                document.getElementById('teacher').style.display="none"; 
            }
        } else {
            // ‡¶Ø‡¶¶‡¶ø URL ‡¶è ID ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶¨‡ßá ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶Æ‡ßã‡¶°
            document.getElementById('app').style.display="block";
            document.getElementById('teacher').style.display="block";
            updateResultTable();
        }
    }, 2500); 
}
</script>
</body>
</html>

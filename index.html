
<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
<title>MS EDUCATION Pro Online Exam App - v5.2 (Ultra Visibility Update)</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+Da+2:wght@400;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>

<script>
    // ====================================================================
    // !!! Firebase V8 Initialization - ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã !!!
    // ====================================================================
    const firebaseConfig = {
      apiKey: "AIzaSyDmReTiRc0voblz_lUX_UpjL38a6YwC23A",
      authDomain: "project1-64a93.firebaseapp.com",
      projectId: "project1-64a93",
      storageBucket: "project1-64a93.firebasestorage.app",
      messagingSenderId: "198510257374",
      appId: "1:198510257374:web:e6a1b9e74c539f5e120e4f",
    };

    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firebase initialized successfully (V8).");
    } catch (e) {
        console.error("Firebase Initialization Failed:", e);
    }
    // ====================================================================

    // --- ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶§‡¶•‡ßç‡¶Ø ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°) ---
    const CONTACT_LINKS = {
        whatsapp: "https://wa.me/8801883109096", 
        facebook: "https://www.facebook.com/mubarak.hosen.37625",
        mobile: "01883109096" // **‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°**
    };
    
    // --- ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ---
    let questions=[], currentQ=0, score=0, studentName="", studentClass="", studentMobile="", studentGender="", examTitle="", examID="", durationMinutes=0;
    let studentAnswers = []; 
    let timerInterval;
    let currentEditExamID = null; 

    let teacherPanel, studentStartPanel, quizPanel, resultPanel, errorMessageDiv, resultListPanel, savedExamsPanel, newExamPanel;

    const sampleQuestions = [
        "‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ?", "‡¶≠‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßá‡¶ó‡ßá‡¶∞ ‡¶ó‡ßÅ‡¶£‡¶´‡¶≤‡¶ï‡ßá ‡¶ï‡ßÄ ‡¶¨‡¶≤‡ßá?", "‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø ‡¶ï‡ßã‡¶® ‡¶¶‡¶ø‡¶ï‡ßá ‡¶ì‡¶†‡ßá?",
        "$(A+B)^2$-‡¶è‡¶∞ ‡¶∏‡ßÇ‡¶§‡ßç‡¶∞ ‡¶ï‡ßÄ?", "‡¶ú‡ßÄ‡¶¨‡¶¶‡ßá‡¶π‡ßá‡¶∞ ‡¶ï‡ßç‡¶∑‡ßÅ‡¶¶‡ßç‡¶∞‡¶§‡¶Æ ‡¶è‡¶ï‡¶ï ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?", "‡¶Ü‡¶≤‡ßã‡¶ï‡¶¨‡¶∞‡ßç‡¶∑ ‡¶ï‡¶ø‡¶∏‡ßá‡¶∞ ‡¶è‡¶ï‡¶ï?",
        "‡¶ï‡ßã‡¶® ‡¶Æ‡ßÅ‡¶ò‡¶≤ ‡¶∏‡¶Æ‡ßç‡¶∞‡¶æ‡¶ü ‡¶§‡¶æ‡¶ú‡¶Æ‡¶π‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶Æ‡¶æ‡¶£ ‡¶ï‡¶∞‡ßá‡¶®?", "‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßÉ‡¶§‡ßç‡¶§‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶∏‡¶æ‡¶∞‡ßç‡¶ß $r$ ‡¶π‡¶≤‡ßá, ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡¶´‡¶≤ ‡¶ï‡¶§?",
        "‡ß™, ‡ß´, ‡ß¨, ‡ß≠, ‡ßÆ ‡¶è‡¶∞ ‡¶ó‡ßú ‡¶ï‡¶§?", "‡¶ú‡¶æ‡¶§‡ßÄ‡¶Ø‡¶º ‡¶´‡ßÅ‡¶≤ ‡¶ï‡ßÄ?", "‡¶ï‡ßã‡¶®‡¶ü‡¶ø ‡¶ï‡¶Æ‡ßç‡¶™‡¶ø‡¶â‡¶ü‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏?",
    ];
    let questionCounter = 1;

    // --- ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°) ---
    function injectContactLinks() {
        const whatsappLink1 = document.getElementById('whatsappLink');
        const facebookLink1 = document.getElementById('facebookLink');
        const whatsappLink2 = document.getElementById('whatsappLink2');
        const facebookLink2 = document.getElementById('facebookLink2');
        const mobileLink1 = document.getElementById('mobileLink1'); // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶™‡ßá‡¶ú
        const mobileLink2 = document.getElementById('mobileLink2'); // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú
        const mobileLink3 = document.getElementById('mobileLink3'); // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶ö‡ßá‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        const whatsappLink3 = document.getElementById('whatsappLink3');
        const facebookLink3 = document.getElementById('facebookLink3');
        
        const duplicateContactBlock = document.getElementById('duplicateContactBlock');
        const duplicateContactBlock2 = document.getElementById('duplicateContactBlock2');


        if (whatsappLink1) whatsappLink1.href = CONTACT_LINKS.whatsapp;
        if (facebookLink1) facebookLink1.href = CONTACT_LINKS.facebook;
        if (whatsappLink2) whatsappLink2.href = CONTACT_LINKS.whatsapp;
        if (facebookLink2) facebookLink2.href = CONTACT_LINKS.facebook;
        // ** ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° **
        if (mobileLink1) { mobileLink1.href = `tel:${CONTACT_LINKS.mobile}`; mobileLink1.innerText = CONTACT_LINKS.mobile; }
        if (mobileLink2) { mobileLink2.href = `tel:${CONTACT_LINKS.mobile}`; mobileLink2.innerText = CONTACT_LINKS.mobile; }
        if (mobileLink3) { mobileLink3.href = `tel:${CONTACT_LINKS.mobile}`; mobileLink3.innerText = CONTACT_LINKS.mobile; }
        // **********************************
        if (whatsappLink3) whatsappLink3.href = CONTACT_LINKS.whatsapp;
        if (facebookLink3) facebookLink3.href = CONTACT_LINKS.facebook;
        
        // ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¨‡ßç‡¶≤‡¶ï‡ßá‡¶∞ ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶® (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶°)
        const contactHTML = `
            <hr style="margin-top: 20px; border-top: 1px dashed #fff;">
            <p class="duplicate-contact-header">
                <i class="fas fa-hand-point-right"></i> ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:
            </p>
            <p style="text-align: center; margin: 10px 0;" class="contact-info-list">
                <strong style="color: var(--danger-color);">‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®</strong><br>
                <i class="fas fa-mobile-alt"></i> Mobile: <a href="tel:${CONTACT_LINKS.mobile}" class="mobile-link contact-mobile-link-dark" style="font-weight: bold;">${CONTACT_LINKS.mobile}</a><br>
                <i class="fab fa-whatsapp" style="color: #25D366;"></i> WhatsApp: <a href="${CONTACT_LINKS.whatsapp}" target="_blank" style="color: #25D366; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a><br>
                <i class="fab fa-facebook" style="color: #1877F2;"></i> Facebook: <a href="${CONTACT_LINKS.facebook}" target="_blank" style="color: #1877F2; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
            </p>
        `;

        if (duplicateContactBlock) duplicateContactBlock.innerHTML = contactHTML;
        if (duplicateContactBlock2) duplicateContactBlock2.innerHTML = contactHTML;
        
        // ** ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ (‡¶õ‡¶¨‡¶ø 3-‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®) **
        const contactInfoBlock = document.getElementById('contactInfoBlock');
        if (contactInfoBlock) {
             contactInfoBlock.innerHTML = `
                <p style="font-size: 18px; color: var(--danger-color); font-weight: 700; text-align: center;">
                    <i class="fas fa-hand-point-right"></i> ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:
                </p>
                <p style="text-align: center; margin: 10px 0;">
                    <strong style="color: var(--danger-color);">‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®</strong><br>
                    <i class="fas fa-mobile-alt"></i> Mobile: <a href="tel:${CONTACT_LINKS.mobile}" id="mobileLink1" class="mobile-link" style="color: var(--primary-color); font-weight: bold;">${CONTACT_LINKS.mobile}</a><br>
                    <i class="fab fa-whatsapp" style="color: #25D366;"></i> WhatsApp: <a href="${CONTACT_LINKS.whatsapp}" target="_blank" id="whatsappLink" style="color: #25D366; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a><br>
                    <i class="fab fa-facebook" style="color: #1877F2;"></i> Facebook: <a href="${CONTACT_LINKS.facebook}" target="_blank" id="facebookLink" style="color: #1877F2; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                </p>
            `;
        }
        // ***************************************************************
    }

    function getBaseUrl() {
        const url = window.location.href.split('?')[0].split('#')[0];
        if (url.endsWith('.html') || url.endsWith('.htm')) {
            return url;
        }
        return url.endsWith('/') ? url : url + '/';
    }

    // ** ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ü‡¶ó‡¶≤‡¶ø‡¶Ç **
    let currentTeacherView = 'newExam'; 
    window.toggleTeacherPanel = function(view) {
        newExamPanel.style.display = 'none';
        savedExamsPanel.style.display = 'none';
        resultListPanel.style.display = 'none';

        document.querySelectorAll('.teacher-nav-btn').forEach(btn => btn.classList.remove('active-nav'));

        if (view === 'newExam') {
            newExamPanel.style.display = 'block';
            resetNewExamPanel(); 
            currentTeacherView = 'newExam';
            document.getElementById('toggleNewExamBtn').classList.add('active-nav');
        } else if (view === 'savedExams') {
            savedExamsPanel.style.display = 'block';
            loadSavedExams();
            currentTeacherView = 'savedExams';
            document.getElementById('toggleSavedExamBtn').classList.add('active-nav');
        } else if (view === 'results') {
            resultListPanel.style.display = 'block';
            updateResultTable();
            currentTeacherView = 'results';
            document.getElementById('toggleResultBtn').classList.add('active-nav');
        }
    }

    // ** ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü **
    function resetNewExamPanel() {
        currentEditExamID = null;
        document.getElementById('examTitle').value = '';
        document.getElementById('examDuration').value = '';
        document.getElementById('examIdDisplay').style.display = 'none';
        document.getElementById('examIdDisplay').innerText = '';
        
        const formsDiv = document.getElementById('questionForms');
        formsDiv.innerHTML = '';
        questionCounter = 1;
        addQuestion(); 
        
        document.getElementById('saveOrUpdateExamBtn').style.display = 'block';
        document.getElementById('generateLinkBtn').style.display = 'none';
        document.getElementById('examLinkContainer').style.display = 'none';
    }

    // ** ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ **
    window.addQuestion = function(qText = '', opts = ['', '', '', ''], correctAns = '0'){
        const formsDiv=document.getElementById('questionForms');
        const newQContainer=document.createElement('div');
        newQContainer.classList.add('question-container');
        
        const placeholderText = qText || (sampleQuestions[(questionCounter-1) % sampleQuestions.length] + ' (AI ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶®)');

        newQContainer.innerHTML=`
        <hr>
        <div class="input-group">
        <label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${questionCounter}:</label>
        <input type="text" class="qText" placeholder="${placeholderText}" value="${qText}">
        </div>
        <div class="input-group options-group">
        <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß" value="${opts[0]}">
        <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®" value="${opts[1]}">
        <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©" value="${opts[2]}">
        <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™" value="${opts[3]}">
        </div>
        <div class="input-group correct-select-group">
        <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
        <select class="correctAnswer small-select">
        <option value="0" ${correctAns == '0' ? 'selected' : ''}>‡ßß</option>
        <option value="1" ${correctAns == '1' ? 'selected' : ''}>‡ß®</option>
        <option value="2" ${correctAns == '2' ? 'selected' : ''}>‡ß©</option>
        <option value="3" ${correctAns == '3' ? 'selected' : ''}>‡ß™</option>
        </select>
        </div>
        `;
        formsDiv.appendChild(newQContainer);
        questionCounter++;
    }

    // ** ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßá‡¶≠/‡¶Ü‡¶™‡¶°‡ßá‡¶ü (Firebase V8) **
    window.saveExam = async function(shouldGenerateLink) {
        examTitle = document.getElementById('examTitle').value.trim();
        durationMinutes = parseInt(document.getElementById('examDuration').value.trim());

        if (!examTitle) { alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!"); return; }
        if (isNaN(durationMinutes) || durationMinutes <= 0) { alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá)!"); return; }

        questions = [];
        const qTexts = document.getElementsByClassName('qText');
        const optsAll = document.getElementsByClassName('opt');
        const correctAll = document.getElementsByClassName('correctAnswer');
        let optIndex = 0;

        for (let i = 0; i < qTexts.length; i++) {
            const q = qTexts[i].value.trim();
            if (!q) { alert(`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i + 1} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!`); return; }
            const options = [];
            let allOptionsFilled = true;
            for (let j = 0; j < 4; j++) {
                const val = optsAll[optIndex].value.trim();
                if (!val) {
                    alert(`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${i + 1}-‡¶è‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ${j + 1} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!`);
                    allOptionsFilled = false;
                    break;
                }
                options.push(val);
                optIndex++;
            }
            if (!allOptionsFilled) return;
            questions.push({
                question: q,
                options: options,
                answer: parseInt(correctAll[i].value)
            });
        }
        if (questions.length === 0) {
            alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®!");
            return;
        }

        if (!currentEditExamID) {
            currentEditExamID = "PRO" + Math.random().toString(36).substr(2, 9).toUpperCase();
            examID = currentEditExamID;
        } else {
            examID = currentEditExamID;
        }

        const examData = {
            examID: examID,
            title: examTitle,
            duration: durationMinutes,
            questions: questions,
            createdAt: firebase.firestore.FieldValue.serverTimestamp() // V8 serverTimestamp
        };

        try {
            if (!db) { throw new Error("Firebase DB not initialized."); }

            // V8: set() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            await db.collection("exams").doc(examID).set(examData, { merge: true });

            if (shouldGenerateLink) {
                generateExamLinkDisplay(examID, examTitle, durationMinutes);
            } else {
                document.getElementById('examIdDisplay').style.display = 'block';
                document.getElementById('examIdDisplay').innerText = `‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ID: ${examID} | ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`;
                document.getElementById('saveOrUpdateExamBtn').style.display = 'none'; 
                document.getElementById('generateLinkBtn').style.display = 'block'; 

                alert(`"${examTitle}" ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
            }

        } catch (e) {
            console.error("‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£/‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert(`‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}.\n\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø Firebase Rules ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®?`);
        }
    }


    // ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® 
    function generateExamLinkDisplay(examId, title, duration) {
        const link = `${getBaseUrl()}?id=${examId}`;

        document.getElementById('examLinkContainer').style.display = "block";
        document.getElementById('examLink').innerHTML = `<strong>üîó ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï:</strong><br><a href="${link}" target="_blank">${link}</a>`;

        examID = examId; 
        examTitle = title;
        durationMinutes = duration;

        document.getElementById('saveOrUpdateExamBtn').style.display = 'none';
        document.getElementById('generateLinkBtn').style.display = 'none';

        alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    }


    // ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    window.shareLink = function(){
        const link=`${getBaseUrl()}?id=${examID}`;
        const message=`üö® ‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ: ${examTitle}\n\n‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶ø‡¶§‡ßá, ‡¶è‡¶á ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ: ${durationMinutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡•§\n\n${link}`;
        
        if (navigator.share) {
            navigator.share({
                title: examTitle,
                text: message,
                url: link,
            })
            .catch((error) => {
                console.log('Error sharing', error);
                copyFallback(message, link); 
            });
        } else {
            copyFallback(message, link);
        }
    }

    // ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶≤‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï
    function copyFallback(message, link) {
        navigator.clipboard.writeText(message).then(() => {
            alert(`‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‚úÖ\n\n‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶™‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ñ‡¶® ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™/‡¶Æ‡ßá‡¶∏‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
        }).catch(err => {
            alert("‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶ú‡ßá ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®:\n" + link);
        });
    }

    // ** ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° (Firebase V8) **
    async function loadSavedExams() {
        const listDiv = document.getElementById('savedExamsList');
        listDiv.innerHTML = '<p style="text-align: center; color: #666;"><i class="fas fa-spinner fa-spin"></i> ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';

        if (!db) {
            listDiv.innerHTML = '<p style="text-align: center; color: var(--danger-color);">Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§</p>';
            return;
        }

        try {
            // V8: collection().orderBy().limit().get() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const snapshot = await db.collection("exams")
                                     .orderBy("createdAt", "desc")
                                     .limit(20)
                                     .get();

            let html = '';
            if (snapshot.empty) {
                html = '<p style="text-align: center; color: var(--danger-color); font-weight: 700;">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
            } else {
                snapshot.forEach(doc => {
                    const exam = doc.data();
                    const examId = doc.id;
                    const link = `${getBaseUrl()}?id=${examId}`;
                    const date = exam.createdAt ? new Date(exam.createdAt.seconds * 1000).toLocaleDateString('bn-BD') : 'N/A';
                    
                    html += `
                        <div class="exam-item">
                            <div class="exam-item-details">
                                <strong>${exam.title}</strong> (${exam.duration} ‡¶Æ‡¶ø. | ${exam.questions.length} ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®)
                                <p style="font-size: 11px; margin: 2px 0; color: #666;">ID: ${examId} | ‡¶§‡ßà‡¶∞‡¶ø: ${date}</p>
                            </div>
                            <div class="exam-item-actions">
                                <button class="exam-btn exam-load-btn" onclick="loadExamForEdit('${examId}')">
                                    <i class="fas fa-edit"></i> ‡¶è‡¶°‡¶ø‡¶ü
                                </button>
                                <button class="exam-btn" onclick="copyExamLink('${link}', '${exam.title}', ${exam.duration})">
                                    <i class="fas fa-link"></i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï
                                </button>
                                <button class="exam-delete-btn exam-btn" onclick="deleteExam('${examId}', '${exam.title}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            listDiv.innerHTML = html;
        } catch (e) {
            console.error("‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            listDiv.innerHTML = '<p style="text-align: center; color: var(--danger-color);">‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§</p>';
        }
    }

    // ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Firebase V8)
    window.deleteExam = async function(examId, examTitle) {
        if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? "${examTitle}" ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡¶ø‡¶≤‡ßá ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶∞‡¶æ ‡¶Ü‡¶∞ ‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡¶®‡¶æ, ‡¶§‡¶¨‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡¶ó‡ßÅ‡¶≤‡¶ø (results) ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§`)) {
            return;
        }

        try {
            if (!db) { throw new Error("Firebase DB not initialized."); }
            
            // V8: doc().delete() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
            await db.collection("exams").doc(examId).delete();
            
            alert(`"${examTitle}" ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            loadSavedExams(); 
            
        } catch (e) {
            console.error("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert(`‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}`);
        }
    }


    window.copyExamLink = function(link, title, duration) {
        examID = link.split('?id=')[1]; 
        examTitle = title;
        durationMinutes = duration;
        
        shareLink();
    }

    // ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶è‡¶°‡¶ø‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Firebase V8)
    window.loadExamForEdit = async function(examId) {
        try {
            // V8: doc().get() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const docSnap = await db.collection("exams").doc(examId).get();

            if (!docSnap.exists) {
                alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!");
                return;
            }

            const examData = docSnap.data();

            toggleTeacherPanel('newExam');
            currentEditExamID = examId;
            
            document.getElementById('examTitle').value = examData.title;
            document.getElementById('examDuration').value = examData.duration;
            document.getElementById('examIdDisplay').style.display = 'block';
            document.getElementById('examIdDisplay').innerText = `‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶õ‡ßá‡¶® (ID: ${examId})`;

            const formsDiv = document.getElementById('questionForms');
            formsDiv.innerHTML = '';
            questionCounter = 1;

            examData.questions.forEach(q => {
                addQuestion(q.question, q.options, q.answer.toString());
            });
            
            document.getElementById('saveOrUpdateExamBtn').style.display = 'block';
            document.getElementById('generateLinkBtn').style.display = 'block'; 
            document.getElementById('examLinkContainer').style.display = 'none';

            alert(`"${examData.title}" ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶°‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§`);

        } catch (e) {
            console.error("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert(`‡¶è‡¶°‡¶ø‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}`);
        }
    }


    /**
     * SHA256 ‡¶π‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
     * ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶ì ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ID ‡¶õ‡¶æ‡ßú‡¶æ‡¶ì ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ì ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§
     * **FINA FIX: ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßá‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶Ü‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§**
     */
    function createUniqueHash(name, mobile, examId, type = 'student') {
        if (type === 'student') {
             // Student (Name+Mobile+ExamID) based check
            const cleanedMobile = mobile.replace(/[^0-9]/g, ''); 
            const key = `${name.toLowerCase().trim()}::${cleanedMobile}::${examId}`;
            return sha256(key);
        } else if (type === 'device') {
            // Device/Browser/Link based check (More restrictive)
            // UserAgent, ExamID ‡¶ì URL ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶ï‡¶á ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡¶∞‡ßá
            const deviceKey = `${navigator.userAgent}::${examId}::${window.location.href.split('?')[0]}`;
            return sha256(deviceKey);
        }
        return Math.random().toString(36).substr(2, 9);
    }

    // ** ‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ **
    window.startExam = async function(){
        // *** ‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ***
        clearInterval(timerInterval); 
        
        studentName=document.getElementById('studentName').value.trim();
        studentGender=document.getElementById('studentGender').value; 
        studentClass=document.getElementById('studentClass').value;
        let studentMobileInput=document.getElementById('studentMobile').value.trim(); 

        if(!studentName){alert("‡¶õ‡¶æ‡¶§‡ßç‡¶∞/‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!"); return;}
        if(!studentClass || studentClass === ""){alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!"); return;}
        
        if(!studentMobileInput){alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®!"); return;}

        const cleanedMobile = studentMobileInput.replace(/[^0-9]/g, ''); 
        
        if (cleanedMobile.length !== 11) {
            alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡ßß‡ßß-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü-‡¶è‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§");
            return;
        }
        
        const validPrefixes = ['013', '014', '015', '016', '017', '018', '019'];
        const prefix = cleanedMobile.substring(0, 3);

        if (!validPrefixes.includes(prefix)) {
            alert("‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡¶ø ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶ü‡¶∞‡ßá‡¶∞ ‡¶∏‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá (‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá 013, 014, 015, 016, 017, 018, ‡¶Ö‡¶•‡¶¨‡¶æ 019 ‡¶¶‡¶ø‡ßü‡ßá)‡•§");
            return;
        }
        
        studentMobile = cleanedMobile; 
        
        // ** ‡¶∏‡ßç‡¶ü‡ßá‡¶™ ‡ßß: ‡¶á‡¶â‡¶ú‡¶æ‡¶∞-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶ö‡ßá‡¶ï (Name+Mobile+ExamID) **
        const uniqueCheckID_Student = createUniqueHash(studentName, studentMobile, examID, 'student');
        
        // ** ‡¶∏‡ßç‡¶ü‡ßá‡¶™ ‡ß®: ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏/‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞-‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶ö‡ßá‡¶ï (Link+Device) **
        const uniqueCheckID_Device = createUniqueHash(studentName, studentMobile, examID, 'device');


        try {
            if (!db) { throw new Error("Firebase DB not initialized."); }

            // Check 1: User-based check
            const checkDocStudent = await db.collection("exam_checks").doc(uniqueCheckID_Student).get();
            if (checkDocStudent.exists) {
                document.getElementById('examFormContent').style.display = 'none';
                document.getElementById('examCompletedMessage').style.display = 'block';
                
                // *** ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶≤‡¶ï ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ***
                document.getElementById('completedMessageText').innerHTML = `
                <div class="duplicate-message-box">
                    <h2><i class="fas fa-exclamation-circle" style="color: var(--danger-color);"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</h2>
                    <p class="duplicate-text-primary">
                        ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§
                    </p>
                    <p class="duplicate-text-secondary">
                        ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§
                    </p>
                </div>
                <div id="duplicateContactBlock2"></div>
                `;
                // ******************************************************
                
                injectContactLinks(); 
                return;
            }
            
            // Check 2: Device/Link based check
            const checkDocDevice = await db.collection("exam_checks").doc(uniqueCheckID_Device).get();
            if (checkDocDevice.exists) {
                document.getElementById('examFormContent').style.display = 'none';
                document.getElementById('examCompletedMessage').style.display = 'block';
                
                // *** ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶≤‡¶ï ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ***
                document.getElementById('completedMessageText').innerHTML = `
                <div class="duplicate-message-box">
                    <h2><i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</h2>
                    <p class="duplicate-text-primary">
                        ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§
                    </p>
                    <p class="duplicate-text-secondary">
                        ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§
                    </p>
                </div>
                <div id="duplicateContactBlock2"></div>
                `;
                // ******************************************************
                
                injectContactLinks(); 
                return;
            }

        } catch (e) {
            console.error("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ö‡ßá‡¶ï ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§");
            return;
        }

        studentAnswers = questions.map(q => ({
            qText: q.question, 
            qOptions: q.options,
            correctAnswerIndex: q.answer,
            studentAnswerIndex: -1 
        }));
        
        studentStartPanel.style.display="none";
        quizPanel.style.display="block";
        
        score = 0; 
        currentQ = 0; 
        startTimer(durationMinutes);
        showQuestion();
    }


    function startTimer(minutes){
        let time=minutes*60;
        const timerDisplay=document.getElementById('timerDisplay');
        clearInterval(timerInterval);

        timerInterval=setInterval(()=>{
        const min=String(Math.floor(time/60)).padStart(2,'0');
        const sec=String(time%60).padStart(2,'0');
        timerDisplay.innerText=`‡¶∏‡¶Æ‡¶Ø‡¶º: ${min}:${sec}`;

        if(time<=60){timerDisplay.style.color='var(--danger-color)';} 
        if(time<=0){
        clearInterval(timerInterval);
        selectAnswer(-1); 
        }
        time--;
        }, 1000);
    }

    function showQuestion(){
        document.getElementById('examTitleDisplay').innerText=examTitle;
        const qDiv=document.getElementById('questionText');
        qDiv.innerText=`‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ${currentQ+1}/${questions.length}: ${questions[currentQ].question}`;

        // ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá, ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü ‡¶ï‡¶∞‡ßá
        const currentStudentAnswer = studentAnswers[currentQ].studentAnswerIndex;
        
        for(let i=0;i<4;i++){
        const optBtn = document.getElementById('opt'+i);
        optBtn.innerText=`${i+1}. ${questions[currentQ].options[i]}`;
        
        optBtn.classList.remove('selected-option');
        if(i === currentStudentAnswer) {
             optBtn.classList.add('selected-option');
        }
        }
    }

    window.selectAnswer = function(optIndex){
        if(currentQ < questions.length) {
            studentAnswers[currentQ].studentAnswerIndex = optIndex;
        }
        
        // ‡¶®‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ‡¶®‡¶æ, ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶™‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        currentQ++;
        if(currentQ<questions.length) {
            showQuestion();
        } else {
            showResult();
        }
    }

    // ** ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (Firebase V8) **
    async function showResult(){
        clearInterval(timerInterval);
        quizPanel.style.display="none";
        resultPanel.style.display="block";

        // *** FINALE FIX: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ***
        score = 0;
        studentAnswers.forEach(answer => {
            if (answer.studentAnswerIndex !== -1 && answer.studentAnswerIndex === answer.correctAnswerIndex) {
                score++;
            }
        });
        // **********************************************
        
        const uniqueCheckID_Student = createUniqueHash(studentName, studentMobile, examID, 'student');
        const uniqueCheckID_Device = createUniqueHash(studentName, studentMobile, examID, 'device');

        injectContactLinks(); 

        const resultData = {
            examID: examID,
            examTitle: examTitle,
            studentName: studentName,
            studentGender: studentGender, 
            studentClass: studentClass,
            studentMobile: studentMobile,
            uniqueCheckID: uniqueCheckID_Student, // Student based ID for result table action
            score: `${score}/${questions.length}`,
            answers: studentAnswers, 
            totalQuestions: questions.length, 
            totalCorrect: score,             
            timestamp: firebase.firestore.FieldValue.serverTimestamp() // V8 serverTimestamp
        };
        
        try {
            if (!db) { throw new Error("Firebase DB not initialized."); }
            
            // 1. ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (V8: add())
            await db.collection("results").add(resultData);
            
            // 2. ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (Student Check)
            await db.collection("exam_checks").doc(uniqueCheckID_Student).set({ 
                examID: examID,
                studentName: studentName,
                type: 'student',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            // 3. ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (Device/Link Check)
            await db.collection("exam_checks").doc(uniqueCheckID_Device).set({ 
                examID: examID,
                studentName: studentName,
                type: 'device',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

        } catch (e) {
            console.error("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
        }
    }


    // ** ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° (Firebase V8) **
    window.updateResultTable = async function(){
        const table=document.getElementById('resultTable');
        table.innerHTML=`<tr><th>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</th><th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th><th>‡¶∏‡¶Æ‡¶Ø‡¶º</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>`; 
        
        if (!db) return;
        
        try {
            // V8: collection().orderBy().limit().get() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const snapshot = await db.collection("results")
                                     .orderBy("timestamp", "desc")
                                     .limit(50)
                                     .get();

            snapshot.forEach(docSnap => {
                const res = docSnap.data();
                const resultId = docSnap.id; 
                const date = res.timestamp ? new Date(res.timestamp.seconds * 1000).toLocaleString('bn-BD', { hour: '2-digit', minute: '2-digit', year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A';
                
                const row=table.insertRow();
                row.insertCell(0).innerText=res.examTitle;
                
                // ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ, ‡¶≤‡¶ø‡¶ô‡ßç‡¶ó, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ï‡¶≤-‡¶è‡¶¨‡¶≤)
                row.insertCell(1).innerHTML=`
                    ${res.studentName} (${res.studentGender ? res.studentGender.slice(0, 1) : 'N/A'})
                    <br><a href="tel:${res.studentMobile}" class="mobile-link" style="font-size: 11px;">${res.studentMobile}</a>
                `; 
                
                // *** ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: TypeError: Cannot read properties of undefined (reading 'replace') ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ***
                const studentClassText = res.studentClass || '';
                // ‡¶è‡¶ñ‡¶® replace() ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ string-‡¶è‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá‡•§
                row.insertCell(2).innerText = studentClassText.replace('Class ', 'C'); 
                
                row.insertCell(3).innerText=res.score;
                row.insertCell(4).innerText=date;
                
                const actionCell = row.insertCell(5);
                actionCell.classList.add('action-buttons');

                const detailBtn = document.createElement('button');
                detailBtn.innerText = '‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§';
                detailBtn.classList.add('detail-btn');
                detailBtn.innerHTML = '<i class="fas fa-eye"></i>';
                detailBtn.onclick = () => showDetailedResult(res);
                actionCell.appendChild(detailBtn);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerText = '‡¶°‡¶ø‡¶≤‡¶ø‡¶ü';
                deleteBtn.classList.add('result-delete-btn');
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteBtn.onclick = () => deleteSingleResult(resultId, res.studentName, res.examTitle, res.uniqueCheckID, res.examID); 
                actionCell.appendChild(deleteBtn);
                
            });
        } catch (e) {
            console.error("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ Firebase Rules ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }

    // ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Firebase V8)
    window.deleteSingleResult = async function(resultId, studentName, examTitle, uniqueCheckID_Student, examId) {
        if (!confirm(`‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§? ‡¶õ‡¶æ‡¶§‡ßç‡¶∞ ${studentName} ‡¶è‡¶∞ "${examTitle}" ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡¶ø‡¶≤‡ßá ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶ü‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶™‡¶æ‡¶¨‡ßá‡•§`)) {
            return;
        }
        
        try {
            if (!db) { throw new Error("Firebase DB not initialized."); }
            
            // 1. ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ (results) ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
            await db.collection("results").doc(resultId).delete();
            
            // 2. ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° (exam_checks: Student) ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
            if (uniqueCheckID_Student) {
                await db.collection("exam_checks").doc(uniqueCheckID_Student).delete();
            }
            
            // 3. ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° (exam_checks: Device) ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ
            // Note: device ID generation requires a temporary hash due to student mobile being unavailable here. 
            // The original logic relies on the student input from the form, which isn't available here.
            // A safer approach might be to query by examId and delete all device checks associated with that exam on the fly, 
            // but for simplicity and security, we rely primarily on the student hash check for re-entry.
            // We'll skip device check deletion here as the primary student check is the most critical block.
            
            // Old device deletion logic (kept commented for reference/safety):
            /*
            const uniqueCheckID_Device_Temp = createUniqueHash(studentName, '01700000000', examId, 'device'); 
            try {
                 await db.collection("exam_checks").doc(uniqueCheckID_Device_Temp).delete();
            } catch (e) {
                console.warn("Device Check ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, ‡¶§‡¶¨‡ßá Student Check ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§", e);
            }
            */

            alert(`${studentName} ‡¶è‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶ü‡¶ø ‡¶è‡¶ñ‡¶® ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§`);
            updateResultTable(); 
            
        } catch (e) {
            console.error("‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
            alert(`‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶ï‡¶æ‡¶∞‡¶£: ${e.message}`);
        }
    }


    function showDetailedResult(res) {
        const modal = document.getElementById('detailModal');
        const modalContentDiv = document.getElementById('modalContent');
        const totalQuestions = res.totalQuestions || res.answers.length;
        const scoreParts = res.score ? res.score.split('/') : ['0', totalQuestions];
        const totalCorrect = parseInt(scoreParts[0]);
        const totalIncorrect = totalQuestions - totalCorrect;
        const date = res.timestamp ? new Date(res.timestamp.seconds * 1000).toLocaleString('bn-BD') : 'N/A';

        let html = `
        <div id="resultSheet">
            <div class="sheet-header">
                <h3 style="margin-bottom: 5px; color: var(--primary-color);">MS EDUCATION</h3>
                <h4 style="margin-top: 5px; color: var(--success-color);">${res.examTitle}</h4>
                <p style="font-size: 14px; color: #666;">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${date}</p>
            </div>
            
            <div class="sheet-info">
                <p><i class="fas fa-user-graduate"></i> <strong>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> ${res.studentName} (${res.studentGender || 'N/A'})</p>
                <p><i class="fas fa-school"></i> <strong>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ:</strong> ${res.studentClass || 'N/A'}</p>
                <p><i class="fas fa-phone-alt"></i> <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ç:</strong> <a href="tel:${res.studentMobile}" class="mobile-link">${res.studentMobile}</a></p>
                <hr style="margin: 10px 0; border-top: 1px dashed #ccc;">
                <p><i class="fas fa-star" style="color: var(--secondary-color);"></i> <strong>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞:</strong> <span class="result-score">${res.score}</span></p>
                <p><i class="fas fa-check" style="color: var(--success-color);"></i> <strong>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</strong> ${totalCorrect}</p>
                <p><i class="fas fa-times" style="color: var(--danger-color);"></i> <strong>‡¶≠‡ßÅ‡¶≤/‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ:</strong> ${totalIncorrect}</p>
            </div>
            
            <h4><i class="fas fa-clipboard-check"></i> ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h4>
            <hr>
        `;

        res.answers.forEach((q, index) => {
            const studentAnsIndex = q.studentAnswerIndex;
            const correctAnsIndex = q.correctAnswerIndex;
            const isCorrect = studentAnsIndex === correctAnsIndex;
            
            let borderStyle = isCorrect ? 'solid var(--success-color)' : (studentAnsIndex === -1 ? 'solid #aaa' : 'solid var(--danger-color)');

            html += `<div class="detail-item" style="border-left: 5px ${borderStyle};">
                <div class="q-text"><strong>${index + 1}. ${q.qText}</strong></div>`;
            
            q.qOptions.forEach((opt, optIndex) => {
                let style = 'font-size: 15px; margin: 3px 0 0 10px;';
                let label = '';
                
                if (optIndex === correctAnsIndex) {
                    style += ' color: var(--success-color); font-weight: 700;'; 
                    label = ' (‡¶∏‡¶†‡¶ø‡¶ï)';
                }
                if (optIndex === studentAnsIndex && !isCorrect) {
                    style += ' color: var(--danger-color); font-weight: 700; text-decoration: line-through;';
                    label = ' (‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶§‡ßç‡¶§‡¶∞)';
                } else if (optIndex === studentAnsIndex && isCorrect) {
                    style += ' color: var(--success-color); font-weight: 700;';
                }
                
                html += `<p style="${style}">
                    ${optIndex + 1}. ${opt}${label}
                </p>`;
            });

            if (studentAnsIndex === -1) {
                html += `<p style="margin-top: 5px;" class="ans-incorrect">‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡¶ü‡¶ø ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>`;
            }
            
            html += `</div>`;
        });
        
        html += `</div>`;
        
        modalContentDiv.innerHTML = html;
        modal.style.display = "block";
    }

    window.closeModal = function() {
        document.getElementById('detailModal').style.display = "none";
    }

    // ** ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü **
    window.onpopstate = function(event) {
        const modal = document.getElementById('detailModal');
        const quiz = document.getElementById('quiz');
        const studentStart = document.getElementById('studentStart');

        if (modal.style.display === 'block') {
            modal.style.display = 'none';
            return; 
        }
        
        if (quiz.style.display === 'block') {
            if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
                clearInterval(timerInterval);
                window.location.reload(); 
            } else {
            }
            return;
        } 
        
        if (studentStart.style.display === 'block') {
            window.location.href = getBaseUrl();
            return;
        }
        
        if (teacherPanel.style.display === 'block' && currentTeacherView !== 'newExam') {
            toggleTeacherPanel('newExam');
            return;
        }
    };


    // *** ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶æ‡¶â‡¶ü‡¶ø‡¶Ç ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü (‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£) ***
    window.onload=function(){
        // FINAL FIX: Cannot read properties of null ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®
        const appContainer = document.getElementById('app');
        teacherPanel = document.getElementById('teacher');
        studentStartPanel = document.getElementById('studentStart');
        quizPanel = document.getElementById('quiz');
        resultPanel = document.getElementById('result');
        errorMessageDiv = document.getElementById('default-message'); 
        resultListPanel = document.getElementById('resultPanel');
        savedExamsPanel = document.getElementById('savedExamsPanel');
        newExamPanel = document.getElementById('newExamPanel');

        errorMessageDiv.style.display="none"; 
        appContainer.style.display="none"; 

        document.getElementById('splashScreen').style.display="flex";

        // *** ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡¶ø‡¶§‡ßç‡¶¨ ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶ï‡¶∞‡ßá 5.5 ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ***
        setTimeout(async () => {
            document.getElementById('splashScreen').style.display="none";
            appContainer.style.display="block";
            
            // Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ
            if (typeof firebase === 'undefined' || !db) {
                document.getElementById('default-message').style.display="block";
                appContainer.style.display="none"; 
                document.getElementById('default-message').innerHTML = `
                    <h2><i class="fas fa-exclamation-triangle"></i> ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø (Firebase Error)</h2>
                    <p style="font-size: 18px; color: var(--danger-color);">‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá **Firebase Console-‡¶è ‡¶ó‡¶ø‡¶Ø‡¶º‡ßá Firestore Database ‡¶è‡¶¨‡¶Ç Rules (‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ)** ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>
                    <p style="font-size: 17px; line-height: 1.6; color: var(--primary-color);">‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá Firebase Rules ‡¶è ‡¶Ø‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ‡¶ü‡¶ø ‡¶¨‡¶∏‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡¶ø‡¶®:</p>
                    <code style="display: block; background: #eee; padding: 10px; border-radius: 5px; margin-top: 10px; overflow-x: auto;">
                        rules_version = '2';<br>
                        service cloud.firestore {<br>
                          &nbsp;&nbsp;match /databases/{database}/documents {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;match /{document=**} {<br>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow read, write: if true;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                          &nbsp;&nbsp;}<br>
                        }<br>
                    </code>
                    <hr style="margin-top: 30px;">
                    <p style="font-size: 15px; color: #666; text-align: center;">**‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:** ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                `;
                return;
            }

            injectContactLinks(); 
            
            const params=new URLSearchParams(window.location.search);
            
            // 1. ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ
            if(params.has('id')){
                const id=params.get('id');
                examID = id;
                
                // *** FINALE FIX: ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶á Device Check ‡¶ï‡¶∞‡¶æ ***
                const uniqueCheckID_Device = createUniqueHash('', '', examID, 'device');
                const docSnapDevice = await db.collection("exam_checks").doc(uniqueCheckID_Device).get();
                
                if (docSnapDevice.exists) {
                    document.getElementById('default-message').style.display="block"; 
                    appContainer.style.display="none";
                    
                    // *** ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶≤‡¶ï ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ***
                    document.getElementById('default-message').innerHTML = `
                        <h2><i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!</h2>
                        <div class="duplicate-message-box large-box">
                            <p class="duplicate-text-primary" style="font-size: 22px;">
                                ‡¶è‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶á‡¶§‡ßã‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§
                            </p>
                            <p class="duplicate-text-secondary" style="font-size: 18px; margin-top: 10px;">
                                ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶á ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶¶‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶®‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶•‡¶æ‡¶ï‡ßá‡¶®, ‡¶§‡¶¨‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡•§
                            </p>
                        </div>
                        <div id="duplicateContactBlock"></div>
                    `;
                    injectContactLinks();
                    return;
                }
                // *************************************************************

                try {
                    // V8: doc().get() ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
                    const docSnap = await db.collection("exams").doc(id).get();
                    
                    if(docSnap.exists){
                        const examData = docSnap.data();
                        
                        examTitle=examData.title;
                        questions=examData.questions;
                        durationMinutes=examData.duration;
                        
                        document.getElementById('studentExamTitleDisplay').innerHTML = `<i class="fas fa-file-alt"></i> ${examTitle}`;
                        document.getElementById('durationDisplay').innerText = durationMinutes;

                        studentStartPanel.style.display="block";
                        
                    } else {
                        document.getElementById('default-message').style.display="block"; 
                        appContainer.style.display="none";
                        document.getElementById('default-message').innerHTML = `
                            <h2><i class="fas fa-exclamation-circle"></i> ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶è‡¶á ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</h2>
                            <p style="font-size: 18px; color: var(--danger-color);">‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®, ‡¶∏‡ßá‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨‡¶§ ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶ ‡¶â‡¶§‡ßç‡¶§‡ßÄ‡¶∞‡ßç‡¶£ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶≠‡ßÅ‡¶≤‡•§</p>
                            <hr>
                            <p style="font-size: 15px; color: #666; text-align: center;">**‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:** ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                        `;
                    }
                } catch (e) {
                    console.error("‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", e);
                    document.getElementById('default-message').style.display="block";
                    appContainer.style.display="none";
                }
            } 
            // 2. ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü)
            else if (params.has('teacher') || !params.toString()) {
                 teacherPanel.style.display="block"; 
                 toggleTeacherPanel('newExam');
                 // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ placeholder ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
                 const firstQInput = document.querySelector('#questionForms .qText');
                 if (firstQInput && !firstQInput.value) {
                    firstQInput.placeholder = sampleQuestions[0] + ' (AI ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶®)';
                 }
            }
            // 3. ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶á‡¶°‡¶ø ‡¶®‡ßá‡¶á
            else {
                document.getElementById('default-message').style.display="block";
                appContainer.style.display="none";
            }

        }, 5500); // *** ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß´.‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ***
    }
</script>
<style>
/* -------------------- ‡¶•‡¶ø‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° -------------------- */
:root {
    --primary-color: #0d47a1; /* ‡¶ó‡¶æ‡ßù ‡¶®‡ßÄ‡¶≤ */
    --secondary-color: #ffb300; /* ‡¶∏‡ßã‡¶®‡¶æ‡¶≤‡ßÄ ‡¶π‡¶≤‡ßÅ‡¶¶ */
    --success-color: #00c853; /* ‡¶∏‡¶¨‡ßÅ‡¶ú */
    --danger-color: #d32f2f; /* ‡¶≤‡¶æ‡¶≤ */
    --info-color: #00bcd4; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶®‡ßÄ‡¶≤ */
    --bg-gradient: linear-gradient(145deg, #1e3c72, #2a5298); 
    --card-bg: #ffffff;
    --text-color: #212121;
}
body { 
    font-family: 'Baloo Da 2', sans-serif; 
    background: var(--bg-gradient); 
    margin:0; 
    padding:0; 
    display:flex; 
    justify-content:center; 
    min-height:100vh; 
    align-items:flex-start; 
    color: var(--text-color);
}
#app { 
    background: var(--card-bg); 
    padding:20px; 
    border-radius:20px; 
    box-shadow:0 15px 40px rgba(0,0,0,0.6); 
    width:100%; 
    max-width:750px; 
    margin-top:20px; 
    margin-bottom: 20px;
    border: 5px solid var(--secondary-color); 
    display: none; 
    transition: all 0.5s ease;
}
h2 { 
    text-align:center; 
    color: var(--primary-color); 
    margin-bottom:15px; 
    border-bottom: 3px solid var(--secondary-color); 
    padding-bottom: 10px; 
    font-size: 26px; 
    font-weight: 800;
}
/* -------------------- ‡¶´‡¶∞‡ßç‡¶Æ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü -------------------- */
.input-group{margin:10px 0;} 
input, select, textarea{
    width:100%; 
    padding:12px; 
    border-radius:8px; 
    border:1px solid #ccc; 
    font-size:16px; 
    box-sizing: border-box;
    transition: all 0.3s;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}
input:focus, select:focus, textarea:focus { 
    border-color: var(--primary-color); 
    box-shadow: 0 0 10px rgba(13, 71, 161, 0.5); 
}
/* ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶õ‡ßã‡¶ü ‡¶á‡¶®‡¶™‡ßÅ‡¶ü */
.options-group {
    display: flex;
    gap: 5px;
}
.options-group .small-input {
    padding: 8px;
    font-size: 14px;
}
.correct-select-group {
    display: flex;
    align-items: center;
    gap: 10px;
}
.correct-select-group label {
    font-weight: 700;
    font-size: 15px;
}
.correct-select-group .small-select {
    width: 30%;
    padding: 8px;
    font-size: 14px;
}
/* -------------------- ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ -------------------- */
button{
    width:100%; 
    padding:12px; 
    border:none; 
    font-size:16px; 
    border-radius:8px; 
    cursor:pointer; 
    margin-top:10px; 
    transition: all 0.3s ease; 
    box-shadow:0 4px 10px rgba(0,0,0,0.2); 
    font-weight:bold;
    display: flex;
    align-items: center;
    justify-content: center;
}
button:hover{transform: translateY(-2px); box-shadow:0 6px 15px rgba(0,0,0,0.3);}
button i { margin-right: 8px; font-size: 16px; } 

#teacher button:not(.share-btn):not(.utility-btn):not(.detail-btn):not(.exam-btn){background:var(--success-color); color:white;}
#quiz .options button{
    background:var(--primary-color); 
    color:white; 
    margin-bottom: 8px; 
}
#quiz .options button:hover{background:#0d3d8f;}
#quiz .options button.selected-option {
    background: var(--secondary-color);
    color: var(--text-color);
    border: 2px solid var(--primary-color);
    box-shadow: 0 0 10px var(--secondary-color);
}

/* Share Buttons */
.share-btn { 
    background: var(--info-color); 
    color: white; 
    margin-bottom: 5px;
}
/* Utility Buttons (‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤) */
.teacher-nav-btn {
    padding: 10px 10px !important;
    font-size: 14px !important;
    margin-top: 0;
}
.teacher-nav-btn.active-nav {
    background: var(--secondary-color) !important;
    color: var(--text-color) !important;
    border: 2px solid var(--primary-color);
    box-shadow: 0 0 10px var(--secondary-color);
}
/* Exam Item Buttons (‡¶Ü‡¶á‡¶ï‡¶® ‡¶∏‡¶π ‡¶õ‡ßã‡¶ü) */
.exam-btn {
    background: #4CAF50; 
    color: white;
    width: auto !important;
    padding: 5px 8px !important; 
    margin: 3px;
    font-size: 12px !important; 
}
.exam-btn i {
    margin: 0 !important;
}
.exam-item-actions {
    display: flex;
    gap: 3px;
    margin-left: 5px;
}
.exam-item-actions button {
    margin: 0 !important;
    padding: 5px 8px !important;
    font-size: 12px !important;
    width: auto !important;
}
.exam-delete-btn {
    background: var(--danger-color) !important;
}
.exam-load-btn {
    background: var(--secondary-color) !important;
    color: var(--text-color) !important;
}

/* -------------------- ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü -------------------- */
.table-container {
    max-height: 350px; 
    overflow-y: auto;
}
th, td{padding:8px; text-align:center; font-size: 12px;} 

td .action-buttons button { 
    width: auto !important; 
    padding: 4px 6px !important; 
    margin: 2px !important; 
    font-size: 11px !important; 
}

/* -------------------- ‡¶ó‡¶∞‡ßç‡¶ú‡¶ø‡¶Ø‡¶º‡¶æ‡¶∏ ‡¶∏‡ßç‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® -------------------- */
#splashScreen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--bg-gradient); 
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
.splash-circle {
    width: 250px; height: 250px; 
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
    animation: rotateGlow 5s ease-out forwards; /* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã */
}
.splash-title {
    font-size: 55px; font-weight: 800; margin-bottom: 5px; opacity: 0;
    color: #fff; text-shadow: 0 0 15px var(--secondary-color), 0 0 20px #fff;
    animation: fadeInScale 2.5s 0.5s forwards;
    letter-spacing: 2px;
}
.splash-subtitle {
    font-size: 20px; opacity: 0; color: #fff;
    animation: fadeIn 2.5s 1s forwards;
    margin-top: 5px;
}
.splash-teacher {
    position: absolute;
    bottom: -150px; /* ‡¶®‡¶æ‡¶Æ‡¶æ‡¶≤‡¶æ‡¶Æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º */
    font-size: 20px; 
    font-weight: 700;
    color: #fff;
    text-align: center;
    line-height: 1.5;
    padding: 10px 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    opacity: 0;
    animation: fadeIn 2s 3.5s forwards; /* ‡¶ò‡ßã‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá */
    border: 3px solid var(--secondary-color);
}
.teacher-glow {
    /* ‡¶∞‡¶ô‡¶ø‡¶® ‡¶ó‡ßç‡¶≤‡ßã ‡¶è‡¶´‡ßá‡¶ï‡ßç‡¶ü */
    background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: rgbMove 3s infinite alternate;
    display: inline-block;
}

@keyframes fadeInScale {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
@keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}
/* ** ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®: ‡¶¶‡ßÅ‡¶á ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶ò‡ßÅ‡¶∞‡ßá ‡¶∏‡ßã‡¶ú‡¶æ ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßç‡¶•‡¶ø‡¶∞ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ** */
@keyframes rotateGlow {
    0% { transform: rotate(0deg); box-shadow: 0 0 50px var(--secondary-color); }
    50% { box-shadow: 0 0 60px var(--info-color); transform: rotate(720deg); } /* ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶¶‡ßÅ‡¶á ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° (720deg) ‡¶ò‡ßã‡¶∞‡¶æ */
    70% { transform: rotate(0deg); } /* ‡¶∏‡ßã‡¶ú‡¶æ ‡¶π‡ßü‡ßá ‡¶∏‡ßç‡¶•‡¶ø‡¶∞ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ */
    100% { transform: rotate(0deg); box-shadow: 0 0 50px var(--secondary-color); } /* ‡¶∏‡ßç‡¶•‡¶ø‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ */
}
@keyframes rgbMove { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

/* -------------------- ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶® ‡¶¨‡ßú ‡¶ì ‡¶≤‡¶æ‡¶≤) -------------------- */
.teacher-info {
    text-align: center; margin-bottom: 15px; font-size: 16px; color: #424242; font-weight: 700; line-height: 1.5;
}
.teacher-info strong, .contact-info-list strong {
    font-size: 20px; /* ** ‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®‡ßá‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú ‡¶¨‡ßú ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã ** */
    color: var(--danger-color) !important; /* ** ‡¶ó‡¶æ‡¶¢‡¶º ‡¶≤‡¶æ‡¶≤ ** */
    display: block; 
    margin-bottom: 5px;
}

/* -------------------- ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶≠‡¶ø‡¶ú‡¶ø‡¶¨‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø) -------------------- */
#examCompletedMessage {
    background: none; 
    padding: 0;
    border-radius: 0;
    border: none;
    text-align: center;
    margin-top: 25px;
    box-shadow: none;
    color: white; /* ‡¶è‡¶á ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶π‡¶¨‡ßá */
}
#examCompletedMessage h2 {
    color: #fff; /* ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßá‡¶°‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
    border-bottom: 3px solid var(--secondary-color);
}
.duplicate-message-box {
    background: #ffecb3; /* ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° */
    padding: 20px;
    border-radius: 15px;
    border: 3px solid var(--danger-color); /* ‡¶≤‡¶æ‡¶≤ ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ */
    text-align: center;
    margin-top: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}
.duplicate-message-box.large-box {
    margin-bottom: 20px;
}
/* ** ‡¶Æ‡ßÇ‡¶≤ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ: ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶® ‡¶ï‡¶∞‡¶õ‡ßá‡¶®‡•§ ** */
.duplicate-text-primary {
    font-size: 20px; 
    color: #8B0000; /* ‡¶ó‡¶æ‡ßù ‡¶≤‡¶æ‡¶≤ (Dark Red) */
    font-weight: 800; 
    margin-top: 0; 
    text-shadow: 1px 1px 2px #ffc107; /* ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã */
}
/* ** ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞‡¶ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ: ‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡•§ ** */
.duplicate-text-secondary {
    font-size: 18px; 
    color: var(--primary-color); /* ‡¶ó‡¶æ‡ßù ‡¶®‡ßÄ‡¶≤ */
    font-weight: 700; 
    margin-top: 10px;
}
/* ** ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ** */
.duplicate-contact-header {
    font-size: 18px; 
    color: #fff; /* ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶∞‡¶ô‡ßá ‡¶π‡ßá‡¶°‡¶æ‡¶∞ */
    font-weight: 700; 
    margin-top: 20px; 
    border-top: 1px dashed #fff; 
    padding-top: 15px;
    text-align: center;
}
/* ** ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ** */
.contact-info-list a {
    font-size: 16px;
    font-weight: bold;
}
/* *** ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∏‡¶æ‡¶¶‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá ‡¶ï‡¶æ‡¶≤‡ßã ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã *** */
/* default-message, examCompletedMessage ‡¶è ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶π‡ßü */
.contact-mobile-link-dark { 
    color: var(--text-color) !important; 
    text-decoration: underline;
} 
/* ******************************************************* */

.detail-item {
    border-left: 5px solid; 
    background: #fff; 
    padding: 10px; 
    border-radius: 5px; 
    margin-bottom: 8px; 
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* ** ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ** */
.modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.8);
}
.modal-content {
    background-color: #fefefe;
    margin: 5% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 90%; 
    max-width: 600px;
    border-radius: 15px;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.modal .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    position: absolute; 
    top: 10px;
    right: 15px;
}
.modal-content button {
    margin-top: 20px;
}
</style>
</head>
<body>

<div id="splashScreen">
    <div class="splash-circle">
        <div class="splash-title">MS EDUCATION</div>
        <div class="splash-subtitle">
            ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï: **‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®**<br>
            "‡¶Ü‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶∞‡¶æ ‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶Æ‡¶æ‡¶¶‡¶∞‡¶æ‡¶∏‡¶æ" 
        </div>
    </div>
    <div class="splash-teacher">
        <i class="fas fa-school" style="color: var(--secondary-color);"></i> ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡ßç‡¶•‡¶æ
    </div>
</div>

<div id="app">
<div id="teacher" style="display:none;">
<div class="glow-title">MS EDUCATION</div>

<div class="teacher-info">
    ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï: <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®</strong><br>
    <i class="fas fa-mosque" style="color: var(--primary-color);"></i> ‡¶Ü‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶∞‡¶æ ‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶Æ‡¶æ‡¶¶‡¶∞‡¶æ‡¶∏‡¶æ
</div>

<div style="display: flex; gap: 5px; margin-bottom: 10px;">
    <button class="teacher-nav-btn" id="toggleNewExamBtn" onclick="toggleTeacherPanel('newExam')" style="background: var(--success-color) !important; flex-grow: 1;"><i class="fas fa-plus"></i> ‡¶®‡¶§‡ßÅ‡¶®</button>
    <button class="teacher-nav-btn" id="toggleSavedExamBtn" onclick="toggleTeacherPanel('savedExams')" style="background: var(--info-color) !important; flex-grow: 1;"><i class="fas fa-list-alt"></i> ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§</button>
    <button class="teacher-nav-btn" id="toggleResultBtn" onclick="toggleTeacherPanel('results')" style="background: var(--danger-color) !important; flex-grow: 1;"><i class="fas fa-poll-h"></i> ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</button>
</div>

<div id="newExamPanel">
    <h2 style="margin-top: 15px;"><i class="fas fa-chalkboard-teacher"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶§‡ßà‡¶∞‡¶ø/‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ</h2>
    <p id="examIdDisplay" style="text-align: center; color: var(--danger-color); font-weight: bold; margin-bottom: 10px; display: none;"></p>
    
    <div class="input-group">
    <input type="text" id="examTitle" placeholder="‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    </div>
    <div class="input-group">
    <input type="number" id="examDuration" placeholder="‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá)">
    </div>
    <p class="warning"><i class="fas fa-exclamation-triangle"></i> ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ‡¶§‡ßá ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡ßã‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>

    <div id="questionForms">
    <div class="question-container">
    <div class="input-group"><label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡ßß:</label><input type="text" class="qText" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßá‡¶∞ ‡¶∞‡¶æ‡¶ú‡¶ß‡¶æ‡¶®‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ï‡ßÄ? (AI ‡¶∏‡¶æ‡¶ú‡ßá‡¶∂‡¶®)"></div>
    <div class="input-group options-group">
    <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß">
    <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®">
    <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©">
    <input type="text" class="opt small-input" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™">
    </div>
    <div class="input-group correct-select-group">
    <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
    <select class="correctAnswer small-select">
    <option value="0">‡ßß</option>
    <option value="1">‡ß®</option>
    <option value="2">‡ß©</option>
    <option value="3">‡ß™</option>
    </select>
    </div>
    </div>
    </div>
    <button id="addQuestionBtn" onclick="addQuestion()"><i class="fas fa-plus-circle"></i> ‡¶Ü‡¶∞‡¶ì ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    
    <button id="saveOrUpdateExamBtn" onclick="saveExam(false)"><i class="fas fa-save"></i> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® / ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    
    <button id="generateLinkBtn" onclick="saveExam(true)" style="display:none; background: var(--success-color);"><i class="fas fa-link"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>


    <div id="examLinkContainer" style="display:none; margin-top: 20px;">
    <hr>
    <div class="glow-title" style="font-size: 30px;">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</div>
    <div id="examLink" class="link-box" style="word-wrap: break-word; font-size: 14px;"></div>

    <button class="share-btn" onclick="shareLink()"><i class="fas fa-share-alt"></i> ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<div id="savedExamsPanel" style="display:none;">
    <h2 style="margin-top: 15px;"><i class="fas fa-clipboard-list"></i> ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</h2>
    <p style="text-align: center; color: var(--primary-color); font-weight: 700; font-size: 14px;">‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶®‡¶ø‡¶® ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
    <div id="savedExamsList">
        </div>
</div>

<div id="resultPanel" style="display:none;">
    <h2 style="margin-top: 15px;"><i class="fas fa-poll-h"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤</h2>
    <button class="teacher-nav-btn" onclick="updateResultTable()" style="background: var(--success-color) !important; margin-top: 0; width: 50%; margin: 0 auto 10px auto;"><i class="fas fa-sync-alt"></i> ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>

    <div class="table-container">
        <table id="resultTable">
            <tr>
                <th>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th><th>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</th><th>‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th><th>‡¶∏‡¶Æ‡¶Ø‡¶º</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
            </tr>
        </table>
    </div>
</div>

</div>

<div id="studentStart" style="display:none;">
<div class="glow-title">MS EDUCATION</div>
<div class="teacher-info">
    ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶™‡¶∞‡¶ø‡¶ö‡¶æ‡¶≤‡¶®‡¶æ‡ßü: <strong>‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®</strong><br>
    <i class="fas fa-mosque" style="color: var(--primary-color);"></i> ‡¶Ü‡¶≤ ‡¶π‡¶æ‡¶Æ‡¶∞‡¶æ ‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶Æ‡¶æ‡¶¶‡¶∞‡¶æ‡¶∏‡¶æ
</div>
<h2 id="studentExamTitleDisplay"><i class="fas fa-file-alt"></i></h2>
<p style="text-align: center; font-size: 18px; color: var(--primary-color); font-weight: 700;">‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ: <span id="durationDisplay"></span> ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</p>
<hr>

<div id="examFormContent">
    <div class="input-group">
    <label class="mandatory-label">‡¶õ‡¶æ‡¶§‡ßç‡¶∞/‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
    <input type="text" id="studentName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
    </div>

    <div class="input-group">
    <label class="mandatory-label">‡¶Ü‡¶™‡¶®‡¶ø:</label>
    <select id="studentGender">
    <option value="‡¶õ‡¶æ‡¶§‡ßç‡¶∞">‡¶õ‡¶æ‡¶§‡ßç‡¶∞</option>
    <option value="‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ">‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßÄ</option>
    </select>
    </div>

    <div class="input-group">
    <label class="mandatory-label">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ (Class):</label>
    <select id="studentClass">
    <option value="">-- ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
    <script>
        // ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶≤‡¶æ‡¶Æ
        for (let i = 1; i <= 12; i++) {
            document.write(`<option value="Class ${i}">Class ${i}</option>`);
        }
    </script>
    </select>
    </div>
    <div class="input-group">
    <label class="mandatory-label">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
    <input type="tel" id="studentMobile" placeholder="‡ßß‡ßß-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: 017xxxxxxxx)" maxlength="11" pattern="01[3-9][0-9]{8}" title="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡ßß‡ßß-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü-‡¶è‡¶∞ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç 013-019 ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§">
    </div>
    <p style="text-align: center; color: var(--danger-color); font-weight: bold;">‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ó‡¶£‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá‡•§</p>
    <button onclick="startExam()"><i class="fas fa-play"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div id="examCompletedMessage" style="display: none;">
    <div id="completedMessageText">
        </div>

    <div id="duplicateContactBlock2">
        </div>

    </div>
</div>

<div id="quiz" style="display:none;">
<div class="glow-title">MS EDUCATION</div>
<h2 id="examTitleDisplay"></h2>
<div class="timer" id="timerDisplay">‡¶∏‡¶Æ‡¶Ø‡¶º: 00:00</div>
<div class="question" id="questionText"></div>
<div class="options">
<button onclick="selectAnswer(0)" id="opt0"></button>
<button onclick="selectAnswer(1)" id="opt1"></button>
<button onclick="selectAnswer(2)" id="opt2"></button>
<button onclick="selectAnswer(3)" id="opt3"></button>
</div>
</div>

<div id="result" style="display:none;">
    <h2><i class="fas fa-check-circle"></i> ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</h2>
    <p style="text-align: center; font-size: 20px; color: var(--success-color); margin-top: 20px; font-weight: 800;">
        ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§
    </p>
    <p style="text-align: center; font-size: 16px; color: var(--primary-color); margin-top: 10px;">
        ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ñ‡ßÅ‡¶¨ ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶ø, ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ú‡¶æ‡¶®‡¶æ‡¶¨‡ßá‡¶®‡•§
    </p>

    <div id="contactInfoBlock" style="margin-top: 30px; border-top: 1px dashed #ccc; padding-top: 20px;">
        <p style="font-size: 18px; color: var(--danger-color); font-weight: 700; text-align: center;">
            <i class="fas fa-hand-point-right"></i> ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:
        </p>
        <p style="text-align: center; margin: 10px 0;">
            <strong style="color: var(--danger-color);">‡¶Æ‡ßã‡¶¨‡¶æ‡¶∞‡¶ï ‡¶π‡ßã‡¶∏‡ßá‡¶®</strong><br>
            <i class="fas fa-mobile-alt"></i> Mobile: <a href="tel:01883109096" id="mobileLink1" class="mobile-link" style="color: var(--primary-color); font-weight: bold;">01883109096</a><br>
            <i class="fab fa-whatsapp" style="color: #25D366;"></i> WhatsApp: <a href="https://wa.me/8801883109096" target="_blank" id="whatsappLink" style="color: #25D366; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a><br>
            <i class="fab fa-facebook" style="color: #1877F2;"></i> Facebook: <a href="https://www.facebook.com/mubarak.hosen.37625" target="_blank" id="facebookLink" style="color: #1877F2; font-weight: bold;">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        </p>
    </div>
    </div>
</div>

<div id="default-message" style="display:none;">
    <div class="glow-title" style="font-size: 40px; margin-bottom: 25px;">MS EDUCATION</div>
    <h2 style="border-bottom: none;"><i class="fas fa-graduation-cap"></i> ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡¶æ‡¶≤</h2>
    <p style="text-align: center; font-size: 18px; color: var(--text-color); margin-bottom: 20px; font-weight: 700;">‡¶™‡ßç‡¶∞‡¶ø‡ßü ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ, ‡¶è‡¶ü‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡¶æ‡¶§‡¶æ‡•§</p>
    <p style="font-size: 17px; line-height: 1.6;">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶Ø‡¶º ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡¶ø‡¶§‡ßá ‡¶π‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡ßá‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ **‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá** (‡¶Ø‡ßá‡¶ü‡¶ø‡¶§‡ßá `?id=` ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</p>
    
    <div class="input-group" style="text-align: center; margin-top: 30px;">
        <p style="color: var(--danger-color); font-weight: 700;"><i class="fas fa-phone-volume"></i> ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
    </div>

    <hr style="margin-top: 30px;">
    <p style="font-size: 15px; color: #666; text-align: center;">**‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:** ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ï ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡¶§‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø `?teacher` ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ö‡¶•‡¶¨‡¶æ **<a href="javascript:void(0);" onclick="window.location.href = window.location.href.split('?')[0] + '?teacher';" style="color: var(--primary-color); font-weight: bold;">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</a>**‡•§</p>

    <div id="duplicateContactBlock"></div>

</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()"><i class="fas fa-times"></i></span>
        <div id="modalContent">
            </div>
        <button id="printBtn" onclick="window.print()" style="background: var(--info-color); color: white;"><i class="fas fa-print"></i> ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∂‡ßÄ‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü/PDF ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

</body>
</html>
